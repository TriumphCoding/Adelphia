<link href="CharactersheetV2.css" rel="stylesheet" type="text/css">

<div class="MasterGrid">

    <!-- Character Picture and Info-->
    <div class="StaticCharacterInfo">
        <div class="StaticCharacterInfoSubGrid">
            <div class="StaticCharacterInfoSubGridName"><label class="PrimaryLabel"><span data-i18n="name-u">Name</span>: <input type="text" class="PrimaryEntry" name="attr_character_name" /></label></div>
            <div class="StaticCharacterInfoSubGridPicture"><img name="attr_character_avatar"/></div>
            <div class="StaticCharacterInfoSubGridToken"><img name="attr_character_token"/></div>
            <div class="StaticCharacterInfoSubGridNotes"><textarea name="attr_character_notes" class="PrimaryNotesEntry" placeholder="Character Notes" data-i18n-place="sheet-CharacterNotesPlaceholder" ></textarea></div>
        </div>
    </div>

    <!-- Header Tabs -->
    <input type="hidden" class="tabstoggle" name="attr_sheetTab"  value="character"  />
    <div class="StaticHeaderRow">
        <div>
            <button type="action" class="PrimaryButton" name="act_character" data-i18n="Character-tabbutton-name">Character</button>
            <button type="action" class="PrimaryButton" name="act_weapons" data-i18n="Weapons-tabbutton-name" >Weapons</button>
            <button type="action" class="PrimaryButton" name="act_items" data-i18n="Items-tabbutton-name" >Items</button>
            <button type="action" class="PrimaryButton" name="act_levels" data-i18n="Levels-tabbutton-name" >Levels</button>
            <button type="action" class="PrimaryButton" name="act_notes" data-i18n="Notes-tabbutton-name" >Notes</button>
            <button type="action" class="PrimaryButton" name="act_configuration" data-i18n="Configuration-tabbutton-name" >Configuration</button>
        </div>
        <script type="text/worker">
            const buttonlist = ["character","weapons","items","levels","notes","configuration"];
            buttonlist.forEach(button => {
                on(`clicked:${button}`, function() {
                    setAttrs({
                        sheetTab: button
                    });
                });
            });
        </script>        
    </div>

    <!-- Quirks -->
    <div class="CharacterQuirkBox">
        <h1 class="PrimaryTitle" data-i18n="quirks-title-u">Quirks</h1>
        <fieldset class="repeating_QuirkList">
            <div class="CharacterQuirkSubgrid">
                <button type="roll" class="PrimaryButton" value="&{template:default} {{name=Test Attack}} {{attack=[[1d20]]}} {{damage=[[2d6]]}}" name="roll_QuirkCheck"></button>
                <input type="text" class="PrimaryEntry" name="attr_quirk_name" placeholder="Quirk Name Goes Here" data-i18n-place="sheet-CharacterQuirkPlaceholder"/>
                <select name="attr_quirk-stat" class="PrimaryDropdown">
                    <option value="STR" selected="selected" data-i18n="STR-Full-Name">Strength</option>
                    <option value="INT" selected="selected" data-i18n="INT-Full-Name">Intelligence</option>
                    <option value="DEX" selected="selected" data-i18n="DEX-Full-Name">Dexterity</option>
                    <option value="SPD" selected="selected" data-i18n="SPD-Full-Name">Speed</option>
                    <option value="LUK" selected="selected" data-i18n="LUK-Full-Name">Luck</option>
                    <option value="CON" selected="selected" data-i18n="CON-Full-Name">Constitution</option>
                    <option value="WIS" selected="selected" data-i18n="WIS-Full-Name">Wisdom</option>
                    <option value="MOV" selected="selected" data-i18n="MOV-Full-Name">Movement</option>
                    <option value="MGT" selected="selected" data-i18n="MGT-Full-Name">Might</option>
                    <option value="ACC" selected="selected" data-i18n="ACC-Full-Name">Accuracy</option>
                    <option value="CRT" selected="selected" data-i18n="CRT-Full-Name">Critical</option>
                    <option value="DGE" selected="selected" data-i18n="DGE-Full-Name">Dodge</option>
                    <option value="AVD" selected="selected" data-i18n="AVD-Full-Name">Avoid</option>
                    <option value="DEF" selected="selected" data-i18n="DEF-Full-Name">Defense</option>
                    <option value="RES" selected="selected" data-i18n="RES-Full-Name">Resistance</option>
                </select>
            </div>
        </fieldset>
    </div>

    <!-- Attacking Stats -->
    <div class="CharacterTallItem">
        <h1 class="PrimaryTitle" data-i18n="Attack-title-u">Attack</h1>
        <label class="PrimaryLabel"><span data-i18n="MGT-Full-Name">Might</span><span>: </span><span name="attr_AttackMight"></span></label>
        <label class="PrimaryLabel"><span data-i18n="ACC-Full-Name">Accuracy</span><span>: </span><span name="attr_AttackAccuracy"></span><span>%</span></label>
        <label class="PrimaryLabel"><span data-i18n="CRT-Full-Name">Critical</span><span>: </span><span name="attr_AttackCritical"></span><span>%</span></label>
        <label class="PrimaryLabel"><span data-i18n="DGE-Full-Name">Dodge</span><span>: </span><span name="attr_AttackDodge"></span><span>%</span></label>
        <label class="PrimaryLabel"><span data-i18n="AVD-Full-Name">Avoid</span><span>: </span><span name="attr_AttackAvoid"></span><span>%</span></label>
        <label class="PrimaryLabel"><span data-i18n="DEF-Full-Name">Defense</span><span>: </span><span name="attr_AttackDefense"></span></label>
        <label class="PrimaryLabel"><span data-i18n="RES-Full-Name">Resistance</span><span>: </span><span name="attr_AttackResistance"></span></label>
    </div>

    <!-- Riposte Stats -->
    <div class="CharacterTallItem">
        <h1 class="PrimaryTitle" data-i18n="Attack-Riposte-u">Riposte</h1>
        <label class="PrimaryLabel"><span data-i18n="MGT-Full-Name">Might</span><span>: </span><span name="attr_RiposteMight"></span></label>
        <label class="PrimaryLabel"><span data-i18n="ACC-Full-Name">Accuracy</span><span>: </span><span name="attr_RiposteAccuracy"></span><span>%</span></label>
        <label class="PrimaryLabel"><span data-i18n="CRT-Full-Name">Critical</span><span>: </span><span name="attr_RiposteCritical"></span><span>%</span></label>
        <label class="PrimaryLabel"><span data-i18n="DGE-Full-Name">Dodge</span><span>: </span><span name="attr_RiposteDodge"></span><span>%</span></label>
        <label class="PrimaryLabel"><span data-i18n="AVD-Full-Name">Avoid</span><span>: </span><span name="attr_RiposteAvoid"></span><span>%</span></label>
        <label class="PrimaryLabel"><span data-i18n="DEF-Full-Name">Defense</span><span>: </span><span name="attr_RiposteDefense"></span></label>
        <label class="PrimaryLabel"><span data-i18n="RES-Full-Name">Resistance</span><span>: </span><span name="attr_RiposteResistance"></span></label>
    </div>

    <!-- Equipped Weapon -->
    <div class="CharacterTallItem">
        <h1 class="PrimaryTitle" data-i18n="weapon-title-u">Weapons</h1>
        <fieldset class="repeating_weapons CharacterWeaponSelection">
            <button type="action" class="PrimaryButton" name="act_SetWeapon"><span name="attr_Weapon-Name"></span></button>
            <input type="text" class="PrimaryEntry" name="attr_Weapon-Name" style="display: none;"/>
        </fieldset>
        <label class="PrimaryLabel"><span data-i18n="equipped-weapon-name-n">Name</span>: <span name="attr_Equipped_Weapon_Name"></span></label>
        <label class="PrimaryLabel"><span data-i18n="equipped-weapon-rune-n">Rune</span>: <span name="attr_Equipped_Weapon_Rune"></span></label>
        <label class="PrimaryLabel"><span data-i18n="equipped-weapon-color-n">Color</span>: <span name="attr_Equipped_Weapon_Color"></span></label>
        <label class="PrimaryLabel"><span data-i18n="equipped-weapon-might-n">Might</span>: <span name="attr_Equipped_Weapon_Might"></span></label>
        <label class="PrimaryLabel"><span data-i18n="equipped-weapon-accuracy-n">Accuracy</span>: <span name="attr_Equipped_Weapon_Accuracy"></span></label>
        <label class="PrimaryLabel"><span data-i18n="equipped-weapon-range-n">Range</span>: <span name="attr_Equipped_Weapon_Range"></span></label>
        <label class="PrimaryLabel"><span data-i18n="equipped-weapon-notes-n">Notes</span>: <span name="attr_Equipped_Weapon_Notes"></span></label>
    </div>

    <!-- Temporary Stat Adjustment -->
    <div class="CharacterWideItem">
        <h1 class="PrimaryTitle" data-i18n="temp-stat-adj-title-u">Temp Stat Adjustment</h1>
        <button type="action" class="PrimaryButton" name="act_temp-stats-start-of-turn" data-i18n="trigger-button">Trigger</button>
        <div class="CharacterTempStatAdjustmentSubgrid">
            <div class="PrimaryLabel"><label data-i18n="stat-change-column-change">Change</label></div>
            <div class="PrimaryLabel"><label data-i18n="stat-change-column-stat">Stat</label></div>
            <div class="PrimaryLabel"><label data-i18n="stat-change-column-turns">Turns</label></div>
            <div class="PrimaryLabel"><label data-i18n="stat-change-column-notes">Notes</label></div>
        </div>
        <fieldset class="repeating_TempStatList">
            <div class="CharacterTempStatAdjustmentSubgrid">
                <input type="number" name="attr_adjustment-value" value="0" class="PrimaryEntry"/>
                <select name="attr_adjustment-stat" class="PrimaryDropdown">
                    <option value="HP" selected="selected" data-i18n="HP-Full-Name">Hit Points</option>
                    <option value="STR" selected="selected" data-i18n="STR-Full-Name">Strength</option>
                    <option value="INT" selected="selected" data-i18n="INT-Full-Name">Intelligence</option>
                    <option value="DEX" selected="selected" data-i18n="DEX-Full-Name">Dexterity</option>
                    <option value="SPD" selected="selected" data-i18n="SPD-Full-Name">Speed</option>
                    <option value="LUK" selected="selected" data-i18n="LUK-Full-Name">Luck</option>
                    <option value="CON" selected="selected" data-i18n="CON-Full-Name">Constitution</option>
                    <option value="WIS" selected="selected" data-i18n="WIS-Full-Name">Wisdom</option>
                    <option value="MOV" selected="selected" data-i18n="MOV-Full-Name">Movement</option>
                    <option value="MGT" selected="selected" data-i18n="MGT-Full-Name">Might</option>
                    <option value="ACC" selected="selected" data-i18n="ACC-Full-Name">Accuracy</option>
                    <option value="CRT" selected="selected" data-i18n="CRT-Full-Name">Critical</option>
                    <option value="DGE" selected="selected" data-i18n="DGE-Full-Name">Dodge</option>
                    <option value="AVD" selected="selected" data-i18n="AVD-Full-Name">Avoid</option>
                    <option value="DEF" selected="selected" data-i18n="DEF-Full-Name">Defense</option>
                    <option value="RES" selected="selected" data-i18n="RES-Full-Name">Resistance</option>
                </select>
                <input type="number" name="attr_adjustment-turns" value="0" class="PrimaryEntry"/>
                <input type="text" name="attr_adjustment-notes" value="" class="PrimaryEntry"/>
            </div>
        </fieldset>
    </div>

    <!-- Equipped Item -->
    <div class="CharacterItem">
        <h1 class="PrimaryTitle" data-i18n="item-title-u">Items</h1>
        <fieldset class="repeating_items CharacterItemSelection">
            <button type="action" class="PrimaryButton" name="act_SetItem"><span name="attr_Item-Name"></span></button>
            <input type="text" class="PrimaryEntry" name="attr_Item-Name" style="display: none;"/>
        </fieldset>
        <label class="PrimaryLabel"><span data-i18n="equipped-item-name-n">Name</span>: <span name="attr_Equipped_Item_Name"></span></label>
        <label class="PrimaryLabel"><span data-i18n="equipped-item-notes-n">Notes</span>: <span name="attr_Equipped_Item_Notes"></span></label>
        <input type="hidden" value="" name="attr_Equipped_Item_Name"/>
    </div>

    <!-- Weapon Creation Section -->
    <div class="WeaponWideItem">
        <h1 class="PrimaryTitle" data-i18n="Weapon-Creation-title-u">Weapon Creation</h1>
    </div>
    <fieldset class="repeating_weapons RepeatingWeaponSection">
        <div>
            <div>
                <h2 data-i18n="Weapon-Title">Weapon</h2>
                <label class="PrimaryLabel"><span data-i18n="Weapon-Name-Label">Name</span>: <input type="text" class="PrimaryEntry" name="attr_Weapon-Name"/></label>
                <label class="PrimaryLabel"><span data-i18n="Weapon-Type-Label">Type</span>: <select name="attr_adjustment-stat">
                        <option value="Sword" selected="selected" data-i18n="Weapon-Type-Sword">Sword</option>
                        <option value="Katana" selected="selected" data-i18n="Weapon-Type-Katana">Katana</option>
                        <option value="Axe" selected="selected" data-i18n="Weapon-Type-Axe">Axe</option>
                        <option value="Club" selected="selected" data-i18n="Weapon-Type-Club">Club</option>
                        <option value="Lance" selected="selected" data-i18n="Weapon-Type-Lance">Lance</option>
                        <option value="Naginata" selected="selected" data-i18n="Weapon-Type-Naginata">Naginata</option>
                        <option value="Gauntlet" selected="selected" data-i18n="Weapon-Type-Gauntlet">Gauntlet</option>
                        <option value="Crossbow" selected="selected" data-i18n="Weapon-Type-Crossbow">Crossbow</option>
                        <option value="Arbalest" selected="selected" data-i18n="Weapon-Type-Arbalest">Arbalest</option>
                        <option value="Knives" selected="selected" data-i18n="Weapon-Type-Knives">Knives</option>
                        <option value="Shuriken" selected="selected" data-i18n="Weapon-Type-Shuriken">Shuriken</option>
                        <option value="Bow" selected="selected" data-i18n="Weapon-Type-Bow">Bow</option>
                        <option value="Yumi" selected="selected" data-i18n="Weapon-Type-Yumi">Yumi</option>
                        <option value="Flintlock" selected="selected" data-i18n="Weapon-Type-Flintlock">Flintlock</option>
                        <option value="Wind" selected="selected" data-i18n="Weapon-Type-Wind">Wind</option>
                        <option value="Dark" selected="selected" data-i18n="Weapon-Type-Dark">Dark</option>
                        <option value="Light" selected="selected" data-i18n="Weapon-Type-Light">Light</option>
                        <option value="Lightning" selected="selected" data-i18n="Weapon-Type-Lightning">Lightning</option>
                        <option value="Fire" selected="selected" data-i18n="Weapon-Type-Fire">Fire</option>
                        <option value="Spirit" selected="selected" data-i18n="Weapon-Type-Spirit">Spirit</option>
                        <option value="Staff" selected="selected" data-i18n="Weapon-Type-Staff">Staff</option>
                        <option value="Claw" selected="selected" data-i18n="Weapon-Type-Claw">Claw</option>
                        <option value="Hoof" selected="selected" data-i18n="Weapon-Type-Hoof">Hoof</option>
                        <option value="Bite" selected="selected" data-i18n="Weapon-Type-Bite">Bite</option>
                        <option value="Gore" selected="selected" data-i18n="Weapon-Type-Gore">Gore</option>
                        <option value="Sting" selected="selected" data-i18n="Weapon-Type-Sting">Sting</option>
                        <option value="Slam" selected="selected" data-i18n="Weapon-Type-Slam">Slam</option>
                    </select>
                </label>
            </div>
        </div>
    </fieldset>
    <!-- ToDo: Finish Weapon Section -->

    <!-- Item Creation Section -->
    <div class="ItemWideItem">
        <h1 class="PrimaryTitle" data-i18n="Item-Creation-title-u">Item Creation</h1>
    </div>
    <fieldset class="repeating_items RepeatingItemSection">
        <div>
            <div>
                <h2 data-i18n="Item-Title">Item</h2>
                <label class="PrimaryLabel"><span data-i18n="Item-Name-Label">Name</span>: <input type="text" class="PrimaryEntry" name="attr_Item-Name"/></label>
            </div>
        </div>
    </fieldset>
    <!-- ToDo: Finish Item Section -->

    <!-- Character Creation and Level Up-->
    <div class="LevelupTallItem">
        <h1 class="PrimaryTitle" data-i18n="Levelup-Class-Stats-title-u">Class Stats</h1>
        <label class="PrimaryLabel"><span data-i18n="Creature-Type-Label">Creature Type</span>: <select name="attr_creature_type">
            <option value="Human" selected="selected" data-i18n="Creature-Type-Human">Human</option>
            <option value="Elf" data-i18n="Creature-Type-Elf">Elf</option>
            <option value="Dwarf" data-i18n="Creature-Type-Dwarf">Dwarf</option>
            <option value="Orc" data-i18n="Creature-Type-Orc">Orc</option>
            <option value="Goblin" data-i18n="Creature-Type-Goblin">Goblin</option>
            <option value="Cyborg" data-i18n="Creature-Type-Cyborg">Cyborg</option>
            <option value="Carnivore" data-i18n="Creature-Type-Carnivore">Carnivore</option>
            <option value="Herbivore" data-i18n="Creature-Type-Herbivore">Herbivore</option>
            <option value="Dragon" data-i18n="Creature-Type-Dragon">Dragon</option>
        </select>
        <div class="LevelupCharacterStatGrid">
            <div class="LevelupCharacterStatGridItem"></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="Base-Stat-Column">Base</span></label></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="Creature-Type-Stat-Column-Abbrev">CT</span></label></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="Skill-Stat-Column-Abbrev">Skill</span></label></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="Growth-Stat-Column-Abbrev">Growth</span></label></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="Total-Stat-Column">Total</span></label></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="Points-Abbrev-Name">Points</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_growth_base_points" value="20-(floor(@{hp_stat_base}/3)+@{str_stat_base}+@{int_stat_base}+@{dex_stat_base}+@{spd_stat_base}+floor(@{luk_stat_base}/2)+@{con_stat_base}+@{wis_stat_base}+floor(@{mov_stat_base}*2))" disabled="true"></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_growth_creature_type_points" value="23-(floor((@{hp_stat_CT}-8)/3)+@{str_stat_CT}+@{int_stat_CT}+@{dex_stat_CT}+@{spd_stat_CT}+floor(@{luk_stat_CT}/2)+@{con_stat_CT}+@{wis_stat_CT}+floor(@{mov_stat_CT}*2))" disabled="true"></div>
            <div class="LevelupCharacterStatGridItem"></div>
            <div class="LevelupCharacterStatGridItem"><button type="action" class="PrimaryButton" name="act_RecalculateStats" data-i18n="LevelUp-RecalculateStats-button" >Recalculate</button></div>
            <div class="LevelupCharacterStatGridItem"></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="HP-Abbrev-Name">HP</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_hp_stat_base" step="1" min="0" max="18" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_hp_stat_CT" step="1" min="-5" max="15" value="10" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_hp_stat_skill" step="1" min="-5" max="15" value="10" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_hp_stat_growth" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_hp_stat_total" value="@{hp_stat_base}+@{hp_stat_CT}+@{hp_stat_growth}+@{hp_stat_skill}" disabled="true"/></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="STR-Abbrev-Name">STR</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_str_stat_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_str_stat_CT" step="1" min="-5" max="15" value="2" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_str_stat_skill" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_str_stat_growth" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_str_stat_total" value="@{str_stat_base}+@{str_stat_CT}+@{str_stat_growth}+@{str_stat_skill}" disabled="true"/></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="INT-Abbrev-Name">INT</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_int_stat_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_int_stat_CT" step="1" min="-5" max="15" value="2" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_int_stat_skill" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_int_stat_growth" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_int_stat_total" value="@{int_stat_base}+@{int_stat_CT}+@{int_stat_growth}+@{int_stat_skill}" disabled="true"/></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="DEX-Abbrev-Name">DEX</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_dex_stat_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_dex_stat_CT" step="1" min="-5" max="15" value="2" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_dex_stat_skill" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_dex_stat_growth" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_dex_stat_total" value="@{dex_stat_base}+@{dex_stat_CT}+@{dex_stat_growth}+@{dex_stat_skill}" disabled="true"/></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="SPD-Abbrev-Name">SPD</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_spd_stat_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_spd_stat_CT" step="1" min="-5" max="15" value="2" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_spd_stat_skill" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_spd_stat_growth" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_spd_stat_total" value="@{spd_stat_base}+@{spd_stat_CT}+@{spd_stat_growth}+@{spd_stat_skill}" disabled="true"/></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="LUK-Abbrev-Name">LUK</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_luk_stat_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_luk_stat_CT" step="1" min="-5" max="15" value="2" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_luk_stat_skill" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_luk_stat_growth" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_luk_stat_total" value="@{luk_stat_base}+@{luk_stat_CT}+@{luk_stat_growth}+@{luk_stat_skill}" disabled="true"/></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="CON-Abbrev-Name">CON</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_con_stat_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_con_stat_CT" step="1" min="-5" max="15" value="2" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_con_stat_skill" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_con_stat_growth" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_con_stat_total" value="@{con_stat_base}+@{con_stat_CT}+@{con_stat_growth}+@{con_stat_skill}" disabled="true"/></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="WIS-Abbrev-Name">WIS</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_wis_stat_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_wis_stat_CT" step="1" min="-5" max="15" value="2" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_wis_stat_skill" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_wis_stat_growth" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_wis_stat_total" value="@{wis_stat_base}+@{wis_stat_CT}+@{wis_stat_growth}+@{wis_stat_skill}" disabled="true"/></div>
            <div class="LevelupCharacterStatGridItem"><label class="PrimaryLabel"><span data-i18n="MOV-Abbrev-Name">MOV</span></label></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_mov_stat_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_mov_stat_CT" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_mov_stat_skill" step="1" value="0" /></div>
            <div class="LevelupCharacterStatGridItem"></div>
            <div class="LevelupCharacterStatGridItem"><input type="number" name="attr_mov_stat_total" value="@{mov_stat_base}+@{mov_stat_CT}+@{mov_stat_skill}" disabled="true"/></div>
        </div>
        <h1 class="PrimaryTitle" data-i18n="Levelup-Class-Skills-title-u">Class Skills</h1>
        <fieldset class="repeating_ClassSkillsList">
            <label class="PrimaryLabel"><span data-i18n="Class-Skill-Name">Skill</span>: <select name="attr_ClassSkill">
                <option value="Nobility" data-i18n="Class-Skill-Nobility">Nobility</option>
                <option value="Ride" data-i18n="Class-Skill-Ride">Ride</option>
                <option value="Fly" data-i18n="Class-Skill-Fly">Fly</option>
                <option value="Armored" data-i18n="Class-Skill-Armored">Armored</option>
                <option value="Runed" data-i18n="Class-Skill-Runed">Runed</option>
                <option value="Sing" data-i18n="Class-Skill-Sing">Sing</option>
                <option value="Combat Skill" data-i18n="Class-Skill-Combat Skill">Combat Skill</option>
                <option value="Weapon Skill" data-i18n="Class-Skill-Weapon Skill">Weapon Skill</option>
                </select>
            </label>
            <label class="PrimaryLabel"><span data-i18n="Class-Skill-Cost">Cost</span>: <input type="number" name="attr_ClassSkillCost" /></label>
            <label class="PrimaryLabel"><span data-i18n="Class-Skill-Description">Description</span>: <textarea class="PrimaryNotesEntry" name="attr_ClassSkillDescription"></textarea></label>
            <label class="PrimaryLabel"><span data-i18n="Class-Skill-Effect">Effect</span>: <textarea class="PrimaryNotesEntry" name="attr_ClassSkillEffect"></textarea></label>
        </fieldset>
    </div>
    <div class="LevelupTallItem">
        <h1 class="PrimaryTitle" data-i18n="Levelup-Combat-Skills-title-u">Combat Skills</h1>
        <span>Lorem Ipsum</span>
        <h1 class="PrimaryTitle" data-i18n="Levelup-Great-Skills-title-u">Great Skills</h1>
        <span>Lorem Ipsum</span>
    </div>
    <div class="LevelupItem">
        <h1 class="PrimaryTitle" data-i18n="Levelup-Growth-Rate-title-u">Growth Rate</h1>
        <label class="PrimaryLabel"><span data-i18n="Background-Label">Background</span>: <select name="attr_background">
            <option value="Human" selected="selected" data-i18n="Creature-Type-Human">Human</option>
            <option value="Elf" data-i18n="Creature-Type-Elf">Elf</option>
            <option value="Dwarf" data-i18n="Creature-Type-Dwarf">Dwarf</option>
            <option value="Orc" data-i18n="Creature-Type-Orc">Orc</option>
            <option value="Goblin" data-i18n="Creature-Type-Goblin">Goblin</option>
            <option value="Cyborg" data-i18n="Creature-Type-Cyborg">Cyborg</option>
            <option value="Carnivore" data-i18n="Creature-Type-Carnivore">Carnivore</option>
            <option value="Herbivore" data-i18n="Creature-Type-Herbivore">Herbivore</option>
            <option value="Dragon" data-i18n="Creature-Type-Dragon">Dragon</option>
        </select>
        <div class="LevelupCharacterGrowthGrid">
            <div class="LevelupCharacterGrowthGridItem"></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="Base-Stat-Column">Base</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="Background-Stat-Column-Abbrev">BG</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="Skill-Stat-Column-Abbrev">Skill</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="Total-Stat-Column">Total</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="Points-Abbrev-Name">Points</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_growth_base_points" value="35-(@{hp_growth_base}+@{str_growth_base}+@{int_growth_base}+@{dex_growth_base}+@{spd_growth_base}+@{luk_growth_base}+@{con_growth_base}+@{wis_growth_base})" disabled="true"></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_growth_background_points" value="40-(@{hp_growth_bg}+@{str_growth_bg}+@{int_growth_bg}+@{dex_growth_bg}+@{spd_growth_bg}+@{luk_growth_bg}+@{con_growth_bg}+@{wis_growth_bg})" disabled="true"></div>
            <div class="LevelupCharacterGrowthGridItem"></div>
            <div class="LevelupCharacterGrowthGridItem"></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="HP-Abbrev-Name">HP</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_hp_growth_base" step="1" min="0" max="18" value="0" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_hp_growth_bg" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_hp_growth_skill" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_hp_growth_total" value="@{hp_growth_base}+@{hp_growth_bg}+@{hp_growth_skill}" disabled="true"/></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="STR-Abbrev-Name">STR</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_str_growth_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_str_growth_bg" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_str_growth_skill" step="1" min="-5" max="15" value="0" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_str_growth_total" value="@{str_growth_base}+@{str_growth_bg}+@{str_growth_skill}" disabled="true"/></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="INT-Abbrev-Name">INT</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_int_growth_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_int_growth_bg" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_int_growth_skill" step="1" min="-5" max="15" value="0" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_int_growth_total" value="@{int_growth_base}+@{int_growth_bg}+@{int_growth_skill}" disabled="true"/></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="DEX-Abbrev-Name">DEX</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_dex_growth_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_dex_growth_bg" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_dex_growth_skill" step="1" min="-5" max="15" value="0" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_dex_growth_total" value="@{dex_growth_base}+@{dex_growth_bg}+@{dex_growth_skill}" disabled="true"/></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="SPD-Abbrev-Name">SPD</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_spd_growth_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_spd_growth_bg" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_spd_growth_skill" step="1" min="-5" max="15" value="0" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_spd_growth_total" value="@{spd_growth_base}+@{spd_growth_bg}+@{spd_growth_skill}" disabled="true"/></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="LUK-Abbrev-Name">LUK</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_luk_growth_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_luk_growth_bg" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_luk_growth_skill" step="1" min="-5" max="15" value="0" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_luk_growth_total" value="@{luk_growth_base}+@{luk_growth_bg}+@{luk_growth_skill}" disabled="true"/></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="CON-Abbrev-Name">CON</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_con_growth_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_con_growth_bg" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_con_growth_skill" step="1" min="-5" max="15" value="0" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_con_growth_total" value="@{con_growth_base}+@{con_growth_bg}+@{con_growth_skill}" disabled="true"/></div>
            <div class="LevelupCharacterGrowthGridItem"><label class="PrimaryLabel"><span data-i18n="WIS-Abbrev-Name">WIS</span></label></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_wis_growth_base" step="1" min="0" max="18" value="0" ></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_wis_growth_bg" step="1" min="-5" max="15" value="5" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_wis_growth_skill" step="1" min="-5" max="15" value="0" /></div>
            <div class="LevelupCharacterGrowthGridItem"><input type="number" name="attr_wis_growth_total" value="@{wis_growth_base}+@{wis_growth_bg}+@{wis_growth_skill}" disabled="true"/></div>
        </div>
    </div>
    <div class="LevelupWideItem">
        <h1 class="PrimaryTitle" data-i18n="Levelup-Growth-Rolls-title-u">Growth Rolls</h1>
        <div><label class="PrimaryLabel"><span data-i18n="Level-u">Level</span>: <input type="text" class="PrimaryEntry" name="attr_character_level" /></label></div>
        <fieldset class="repeating_CharacterLevel">
            <div class="RepeatingCharacterLevelSectionHeader">
                <div class="LevelupCharacterLevelGridItemHeader"><label class="PrimaryLabel"><span data-i18n="HP-Abbrev-Name">HP</span></label></div>
                <div class="LevelupCharacterLevelGridItemHeader"><label class="PrimaryLabel"><span data-i18n="STR-Abbrev-Name">STR</span></label></div>
                <div class="LevelupCharacterLevelGridItemHeader"><label class="PrimaryLabel"><span data-i18n="INT-Abbrev-Name">INT</span></label></div>
                <div class="LevelupCharacterLevelGridItemHeader"><label class="PrimaryLabel"><span data-i18n="DEX-Abbrev-Name">DEX</span></label></div>
                <div class="LevelupCharacterLevelGridItemHeader"><label class="PrimaryLabel"><span data-i18n="SPD-Abbrev-Name">SPD</span></label></div>
                <div class="LevelupCharacterLevelGridItemHeader"><label class="PrimaryLabel"><span data-i18n="LUK-Abbrev-Name">LUK</span></label></div>
                <div class="LevelupCharacterLevelGridItemHeader"><label class="PrimaryLabel"><span data-i18n="CON-Abbrev-Name">CON</span></label></div>
                <div class="LevelupCharacterLevelGridItemHeader"><label class="PrimaryLabel"><span data-i18n="WIS-Abbrev-Name">WIS</span></label></div>
                <div class="LevelupCharacterLevelGridItemHeader"><button type="action" class="PrimaryButton" name="act_LevelUp" data-i18n="LevelUp-LevelUp-button" >Level<br>Up</button></div>
            </div>
            <div class="RepeatingCharacterLevelSection">
                <div class="LevelupCharacterLevelGridItem"><input type="number" name="attr_hp_growth" step="1" min="0" max="18" /></div>
                <div class="LevelupCharacterLevelGridItem"><input type="number" name="attr_str_growth" step="1" min="0" max="18" /></div>
                <div class="LevelupCharacterLevelGridItem"><input type="number" name="attr_int_growth" step="1" min="0" max="18" /></div>
                <div class="LevelupCharacterLevelGridItem"><input type="number" name="attr_dex_growth" step="1" min="0" max="18" /></div>
                <div class="LevelupCharacterLevelGridItem"><input type="number" name="attr_spd_growth" step="1" min="0" max="18" /></div>
                <div class="LevelupCharacterLevelGridItem"><input type="number" name="attr_luk_growth" step="1" min="0" max="18" /></div>
                <div class="LevelupCharacterLevelGridItem"><input type="number" name="attr_con_growth" step="1" min="0" max="18" /></div>
                <div class="LevelupCharacterLevelGridItem"><input type="number" name="attr_wis_growth" step="1" min="0" max="18" /></div>
                <div class="LevelupCharacterLevelGridItem"><button type="action" class="PrimaryButton" name="act_RerollLevel" data-i18n="LevelUp-Reroll-button" >Reroll</button></div>
                <div class="LevelupCharacterLevelGridItem"><button type="action" class="PrimaryButton" name="act_DeleteLevel" data-i18n="LevelUp-Delete-button" >Delete</button></div>
            </div>
        </fieldset>
        <script type="text/worker">

            on("change:repeating_CharacterLevel", function() {
                SetLevel();
            });
        
            on("sheet:opened", function() {
                SetLevel();
            });
        
            on(`clicked:repeating_CharacterLevel`, function(eventInfo) {
                const rowid = eventInfo.sourceAttribute.split('_')[2];
                switch(eventInfo.htmlAttributes.name) {
                    case `act_DeleteLevel`:                
                        removeRepeatingRow(`repeating_CharacterLevel_${rowid}`);
                        break;
                    case `act_RerollLevel`:
                        RollLevel(rowid);
                        break;
                    case `act_LevelUp`:
                        const newrowid = generateRowID();
                        RollLevel(newrowid);
                        break;
                    default:
                        console.log(`Button not recognized`);
                }
                SetLevel();
            });
        
            function getRandomInt(max) {
                return (Math.floor(Math.random() * (max + 1)));
            };
        
            function d10() {
                return getRandomInt(9);
            };
        
            function d10d10() {
                return getRandomInt(9) + getRandomInt(9);
            };
        
            function d100() {
                return getRandomInt(99);
            };
        
            function RollLevel(rowid) {
                const statlist = ["hp","str","dex","int","spd","luk","con","wis"];
                var vGrowthQty = 0;
                getAttrs([
                    "hp_growth_base","hp_growth_bg","hp_growth_skill",
                    "str_growth_base","str_growth_bg","str_growth_skill",
                    "dex_growth_base","dex_growth_bg","dex_growth_skill",
                    "int_growth_base","int_growth_bg","int_growth_skill",
                    "spd_growth_base","spd_growth_bg","spd_growth_skill",
                    "luk_growth_base","luk_growth_bg","luk_growth_skill",
                    "con_growth_base","con_growth_bg","con_growth_skill",
                    "wis_growth_base","wis_growth_bg","wis_growth_skill",
                    "NoBadLevels"
                ], function(growthrate) {
                    var vGrowth = {
                        "hp": parseInt(growthrate.hp_growth_base) + parseInt(growthrate.hp_growth_bg) + parseInt(growthrate.hp_growth_skill),
                        "str": parseInt(growthrate.str_growth_base) + parseInt(growthrate.str_growth_bg) + parseInt(growthrate.str_growth_skill),
                        "dex": parseInt(growthrate.dex_growth_base) + parseInt(growthrate.dex_growth_bg) + parseInt(growthrate.dex_growth_skill),
                        "int": parseInt(growthrate.int_growth_base) + parseInt(growthrate.int_growth_bg) + parseInt(growthrate.int_growth_skill),
                        "spd": parseInt(growthrate.spd_growth_base) + parseInt(growthrate.spd_growth_bg) + parseInt(growthrate.spd_growth_skill),
                        "luk": parseInt(growthrate.luk_growth_base) + parseInt(growthrate.luk_growth_bg) + parseInt(growthrate.luk_growth_skill),
                        "con": parseInt(growthrate.con_growth_base) + parseInt(growthrate.con_growth_bg) + parseInt(growthrate.con_growth_skill),
                        "wis": parseInt(growthrate.wis_growth_base) + parseInt(growthrate.wis_growth_bg) + parseInt(growthrate.wis_growth_skill)
                    };
                    var vGrowthRoll = {
                        "hp": 0,
                        "str": 0,
                        "dex": 0,
                        "int": 0,
                        "spd": 0,
                        "luk": 0,
                        "con": 0,
                        "wis": 0
                    };
                    for (let i = 0; i < 1000; i++) {
                        vGrowthRoll.hp = d10d10();
                        vGrowthRoll.str = d10d10();
                        vGrowthRoll.dex = d10d10();
                        vGrowthRoll.int = d10d10();
                        vGrowthRoll.spd = d10d10();
                        vGrowthRoll.luk = d10d10();
                        vGrowthRoll.con = d10d10();
                        vGrowthRoll.wis = d10d10();
                        vGrowthQty = 0;
                        if (vGrowthRoll.hp <= vGrowth.hp ) { vGrowthQty = vGrowthQty + 1; }
                        if (vGrowthRoll.str <= vGrowth.str ) { vGrowthQty = vGrowthQty + 1; }
                        if (vGrowthRoll.dex <= vGrowth.dex ) { vGrowthQty = vGrowthQty + 1; }
                        if (vGrowthRoll.int <= vGrowth.int ) { vGrowthQty = vGrowthQty + 1; }
                        if (vGrowthRoll.spd <= vGrowth.spd ) { vGrowthQty = vGrowthQty + 1; }
                        if (vGrowthRoll.luk <= vGrowth.luk ) { vGrowthQty = vGrowthQty + 1; }
                        if (vGrowthRoll.con <= vGrowth.con ) { vGrowthQty = vGrowthQty + 1; }
                        if (vGrowthRoll.wis <= vGrowth.wis ) { vGrowthQty = vGrowthQty + 1; }
                        if ( (!growthrate.NoBadLevels) || (vGrowthQty >= 3) ) {
                            break;
                        }
                    }
                    setAttrs({
                        [`repeating_CharacterLevel_${rowid}_hp_growth`]: vGrowthRoll.hp,
                        [`repeating_CharacterLevel_${rowid}_str_growth`]: vGrowthRoll.str,
                        [`repeating_CharacterLevel_${rowid}_dex_growth`]: vGrowthRoll.dex,
                        [`repeating_CharacterLevel_${rowid}_int_growth`]: vGrowthRoll.int,
                        [`repeating_CharacterLevel_${rowid}_spd_growth`]: vGrowthRoll.spd,
                        [`repeating_CharacterLevel_${rowid}_luk_growth`]: vGrowthRoll.luk,
                        [`repeating_CharacterLevel_${rowid}_con_growth`]: vGrowthRoll.con,
                        [`repeating_CharacterLevel_${rowid}_wis_growth`]: vGrowthRoll.wis
                    });
                });
            };
        
            function SetLevel() {
                getSectionIDs("repeating_CharacterLevel", function(idarray) {
                    setAttrs({
                        character_level: idarray.length
                    });
                    if (idarray.length === 0) {
                        const newrowid = generateRowID();
                        RollLevel(newrowid);
                        setAttrs({
                            character_level: 1
                        });
                    }
                });
            };

            var BackgroundGrowth = {
                "Orc": {
                  "Background": "Orc",
                  "HP": "5",
                  "STR": "6",
                  "INT": "5",
                  "DEX": "4",
                  "SPD": "5",
                  "LUK": "5",
                  "CON": "5",
                  "WIS": "5"
                },
                "Human": {
                  "Background": "Human",
                  "HP": "5",
                  "STR": "5",
                  "INT": "5",
                  "DEX": "5",
                  "SPD": "5",
                  "LUK": "5",
                  "CON": "5",
                  "WIS": "5"
                },
                "Carnivore": {
                  "Background": "Carnivore",
                  "HP": "5",
                  "STR": "7",
                  "INT": "3",
                  "DEX": "5",
                  "SPD": "6",
                  "LUK": "5",
                  "CON": "5",
                  "WIS": "4"
                },
                "Elf": {
                  "Background": "Elf",
                  "HP": "4",
                  "STR": "5",
                  "INT": "5",
                  "DEX": "7",
                  "SPD": "6",
                  "LUK": "5",
                  "CON": "3",
                  "WIS": "5"
                },
                "Cyborg": {
                  "Background": "Cyborg",
                  "HP": "5",
                  "STR": "6",
                  "INT": "5",
                  "DEX": "4",
                  "SPD": "5",
                  "LUK": "5",
                  "CON": "5",
                  "WIS": "5"
                },
                "Goblin": {
                  "Background": "Goblin",
                  "HP": "4",
                  "STR": "5",
                  "INT": "5",
                  "DEX": "6",
                  "SPD": "7",
                  "LUK": "5",
                  "CON": "4",
                  "WIS": "4"
                },
                "Dwarf": {
                  "Background": "Dwarf",
                  "HP": "6",
                  "STR": "5",
                  "INT": "3",
                  "DEX": "5",
                  "SPD": "4",
                  "LUK": "5",
                  "CON": "6",
                  "WIS": "6"
                },
                "Herbivore": {
                  "Background": "Herbivore",
                  "HP": "5",
                  "STR": "5",
                  "INT": "5",
                  "DEX": "5",
                  "SPD": "7",
                  "LUK": "5",
                  "CON": "4",
                  "WIS": "4"
                },
                "Dragon": {
                  "Background": "Dragon",
                  "HP": "5",
                  "STR": "5",
                  "INT": "7",
                  "DEX": "5",
                  "SPD": "3",
                  "LUK": "4",
                  "CON": "5",
                  "WIS": "6"
                }
              };

            var CreatureTypeStat = {
                "Orc": {
                  "CreatureType": "Orc",
                  "HP": "10",
                  "STR": "4",
                  "INT": "2",
                  "DEX": "1",
                  "SPD": "2",
                  "LUK": "0",
                  "CON": "2",
                  "WIS": "2",
                  "MOV": "5"
                },
                "Human": {
                  "CreatureType": "Human",
                  "HP": "10",
                  "STR": "2",
                  "INT": "2",
                  "DEX": "2",
                  "SPD": "2",
                  "LUK": "2",
                  "CON": "2",
                  "WIS": "2",
                  "MOV": "5"
                },
                "Carnivore": {
                  "CreatureType": "Carnivore",
                  "HP": "10",
                  "STR": "4",
                  "INT": "3",
                  "DEX": "2",
                  "SPD": "3",
                  "LUK": "2",
                  "CON": "2",
                  "WIS": "0",
                  "MOV": "5"
                },
                "Elf": {
                  "CreatureType": "Elf",
                  "HP": "7",
                  "STR": "2",
                  "INT": "2",
                  "DEX": "3",
                  "SPD": "4",
                  "LUK": "2",
                  "CON": "0",
                  "WIS": "2",
                  "MOV": "5"
                },
                "Cyborg": {
                  "CreatureType": "Cyborg",
                  "HP": "10",
                  "STR": "4",
                  "INT": "0",
                  "DEX": "2",
                  "SPD": "2",
                  "LUK": "2",
                  "CON": "3",
                  "WIS": "1",
                  "MOV": "5"
                },
                "Goblin": {
                  "CreatureType": "Goblin",
                  "HP": "7",
                  "STR": "2",
                  "INT": "2",
                  "DEX": "3",
                  "SPD": "4",
                  "LUK": "2",
                  "CON": "1",
                  "WIS": "1",
                  "MOV": "5"
                },
                "Dwarf": {
                  "CreatureType": "Dwarf",
                  "HP": "13",
                  "STR": "2",
                  "INT": "0",
                  "DEX": "2",
                  "SPD": "1",
                  "LUK": "2",
                  "CON": "3",
                  "WIS": "3",
                  "MOV": "5"
                },
                "Herbivore": {
                  "CreatureType": "Herbivore",
                  "HP": "10",
                  "STR": "2",
                  "INT": "2",
                  "DEX": "2",
                  "SPD": "3",
                  "LUK": "2",
                  "CON": "0",
                  "WIS": "1",
                  "MOV": "6"
                },
                "Dragon": {
                  "CreatureType": "Dragon",
                  "HP": "10",
                  "STR": "2",
                  "INT": "4",
                  "DEX": "2",
                  "SPD": "1",
                  "LUK": "2",
                  "CON": "2",
                  "WIS": "3",
                  "MOV": "4"
                }
              }

            on("change:background", function() {
                getAttrs(["background"], function(values) {
                    let bg = values.background;
                    setAttrs({
                        "hp_growth_bg": BackgroundGrowth[bg].HP,
                        "str_growth_bg": BackgroundGrowth[bg].STR,
                        "int_growth_bg": BackgroundGrowth[bg].INT,
                        "dex_growth_bg": BackgroundGrowth[bg].DEX,
                        "spd_growth_bg": BackgroundGrowth[bg].SPD,
                        "luk_growth_bg": BackgroundGrowth[bg].LUK,
                        "con_growth_bg": BackgroundGrowth[bg].CON,
                        "wis_growth_bg": BackgroundGrowth[bg].WIS
                    });
                });
            });

            on("change:creature_type", function() {
                getAttrs(["creature_type"], function(values) {
                    let ct = values.creature_type;
                    setAttrs({
                        "hp_stat_ct": CreatureTypeStat[ct].HP,
                        "str_stat_ct": CreatureTypeStat[ct].STR,
                        "int_stat_ct": CreatureTypeStat[ct].INT,
                        "dex_stat_ct": CreatureTypeStat[ct].DEX,
                        "spd_stat_ct": CreatureTypeStat[ct].SPD,
                        "luk_stat_ct": CreatureTypeStat[ct].LUK,
                        "con_stat_ct": CreatureTypeStat[ct].CON,
                        "wis_stat_ct": CreatureTypeStat[ct].WIS,
                        "mov_stat_ct": CreatureTypeStat[ct].MOV
                    });
                });
            });

            on("clicked:RecalculateStats change:StaticLevels change:NoBadStats change:repeating_CharacterLevel", function() {
                CalculateStats();
            });

            const StatList = ["hp","str","int","dex","spd","luk","con","wis"];
            StatList.forEach(stat => {
                on(`change:${stat}_growth_base change:${stat}_growth_bg`, function() {
                    CalculateStats();
                });
            });

            function CalculateStats() {
                var EarnedGrowths = {
                    "hp":0,
                    "str":0,
                    "int":0,
                    "dex":0,
                    "spd":0,
                    "luk":0,
                    "con":0,
                    "wis":0
                };
                var GrowthWiff = {
                    "hp":0,
                    "str":0,
                    "int":0,
                    "dex":0,
                    "spd":0,
                    "luk":0,
                    "con":0,
                    "wis":0
                };
                getSectionIDs("repeating_CharacterLevel", function(idarray) {
                    StatList.forEach(stat => {
                        idarray.forEach(rowid => {
                            var LevelRoll = `repeating_CharacterLevel_${rowid}_${stat}_growth`;
                            var GrowthEntryBase = `${stat}_growth_base`;
                            var GrowthEntryBackground = `${stat}_growth_bg`;
                            var GrowthEntrySkill = `${stat}_growth_skill`;
                            getAttrs([`${LevelRoll}`, `${GrowthEntryBase}`, `${GrowthEntryBackground}`, `${GrowthEntrySkill}`, "NoBadStats", "character_level", "StaticLevels"], function(values) {
                                var Growth = parseInt(values[GrowthEntryBase]) + parseInt(values[GrowthEntryBackground]) + parseInt(values[GrowthEntrySkill]);
                                var Roll = parseInt(values[LevelRoll]);
                                if (Roll <= Growth + GrowthWiff[stat]) {
                                    EarnedGrowths[stat] = EarnedGrowths[stat] + 1;
                                }
                                if (Roll > Growth + GrowthWiff[stat] && parseInt(values.NoBadStats) == 1) {
                                    GrowthWiff[stat] = GrowthWiff[stat] + 1;
                                } else {
                                    GrowthWiff[stat] = 0;
                                }
                                if (parseInt(values.StaticLevels) == 1) {
                                    EarnedGrowths[stat] = Math.floor(parseInt(values.character_level) * Growth / 18.0);
                                }
                                setAttrs({
                                    [`${stat}_stat_growth`]: EarnedGrowths[stat]
                                });
                            });
                        });
                    });
                });
            };

            var ClassSkills = {
                "Weapon Skill": {
                    "Name": "Weapon Skill",
                    "Cost": "2",
                    "Description": "You have trained in more than a single form of self defense",
                    "Effect": "You can equip an additional weapon type. You can purchase this background as many times as you would like."
                },
                "Nobility": {
                    "Name": "Nobility",
                    "Cost": "4",
                    "Description": "Your family line has a history and you have the potential to grow into that history",
                    "Effect": "Get +1 to all your Growth Rates."
                },
                "Armored": {
                    "Name": "Armored",
                    "Cost": "2",
                    "Description": "You are trained in the use of Heavy Armor and are a mobile battlefield wall",
                    "Effect": "Gain +4 CON | +3 HP | -1 MOV | +1 HP Growth | +2 CON Growth"
                },
                "Sing": {
                    "Name": "Sing",
                    "Cost": "3",
                    "Description": "You can inspire your allies around you to action",
                    "Effect": "You can spend your action performing for one of your allies that has already taken their action at Range 1. They recover all spent movement and may take another turn as though it was the start of their turn again. (They can take their second turn any time during this allied phase)."
                },
                "Ride": {
                    "Name": "Ride",
                    "Cost": "4",
                    "Description": "You are trained in riding a horse and can put your enhanced mobility to good use in the field",
                    "Effect": "You can spend unspent movement after performing an action each turn."
                },
                "Runed": {
                    "Name": "Runed",
                    "Cost": "2",
                    "Description": "You are trained in the use of Protective Runes and are otherwise magically shielded",
                    "Effect": "Gain +4 WIS | +3 HP | -1 MOV | +1 HP Growth | +2 WIS Growth"
                },
                "Fly": {
                    "Name": "Fly",
                    "Cost": "4",
                    "Description": "You are trained in moving through the air and can move in ways a grounded person cannot",
                    "Effect": "You ignore all terrain movement costs and can fly over most impassable terrain. Please work with your GM about what constitutes flight indoors"
                },
                "Combat Skill": {
                    "Name": "Combat Skill",
                    "Cost": "3",
                    "Description": "You have trained in a specialized form of combat",
                    "Effect": "Gain 1 Combat Skill Point. See the section on combat skills for what you can spend this on. You can purchase this background as many times as you would like."
                }
            };

            function CalculateSkillStats() {
                var ClassSkillsCost = {
                    "Weapon Skill": {
                      "Name": "Weapon Skill",
                      "Cost": "2",
                      "hp": "0",
                      "str": "0",
                      "int": "0",
                      "dex": "0",
                      "skl": "0",
                      "spd": "0",
                      "luk": "0",
                      "con": "0",
                      "wis": "0",
                      "mov": "0",
                      "hpg": "0",
                      "strg": "0",
                      "intg": "0",
                      "dexg": "0",
                      "sklg": "0",
                      "spdg": "0",
                      "lukg": "0",
                      "cong": "0",
                      "wisg": "0"
                    },
                    "Nobility": {
                      "Name": "Nobility",
                      "Cost": "4",
                      "hp": "0",
                      "str": "0",
                      "int": "0",
                      "dex": "0",
                      "skl": "0",
                      "spd": "0",
                      "luk": "0",
                      "con": "0",
                      "wis": "0",
                      "mov": "0",
                      "hpg": "1",
                      "strg": "1",
                      "intg": "1",
                      "dexg": "1",
                      "sklg": "1",
                      "spdg": "1",
                      "lukg": "1",
                      "cong": "1",
                      "wisg": "1"
                    },
                    "Armored": {
                      "Name": "Armored",
                      "Cost": "2",
                      "hp": "3",
                      "str": "0",
                      "int": "0",
                      "dex": "0",
                      "skl": "0",
                      "spd": "0",
                      "luk": "0",
                      "con": "4",
                      "wis": "0",
                      "mov": "-1",
                      "hpg": "1",
                      "strg": "0",
                      "intg": "0",
                      "dexg": "0",
                      "sklg": "0",
                      "spdg": "0",
                      "lukg": "0",
                      "cong": "2",
                      "wisg": "0"
                    },
                    "Sing": {
                      "Name": "Sing",
                      "Cost": "3",
                      "hp": "0",
                      "str": "0",
                      "int": "0",
                      "dex": "0",
                      "skl": "0",
                      "spd": "0",
                      "luk": "0",
                      "con": "0",
                      "wis": "0",
                      "mov": "0",
                      "hpg": "0",
                      "strg": "0",
                      "intg": "0",
                      "dexg": "0",
                      "sklg": "0",
                      "spdg": "0",
                      "lukg": "0",
                      "cong": "0",
                      "wisg": "0"
                    },
                    "Ride": {
                      "Name": "Ride",
                      "Cost": "4",
                      "hp": "0",
                      "str": "0",
                      "int": "0",
                      "dex": "0",
                      "skl": "0",
                      "spd": "0",
                      "luk": "0",
                      "con": "0",
                      "wis": "0",
                      "mov": "0",
                      "hpg": "0",
                      "strg": "0",
                      "intg": "0",
                      "dexg": "0",
                      "sklg": "0",
                      "spdg": "0",
                      "lukg": "0",
                      "cong": "0",
                      "wisg": "0"
                    },
                    "Runed": {
                      "Name": "Runed",
                      "Cost": "2",
                      "hp": "3",
                      "str": "0",
                      "int": "0",
                      "dex": "0",
                      "skl": "0",
                      "spd": "0",
                      "luk": "0",
                      "con": "0",
                      "wis": "4",
                      "mov": "-1",
                      "hpg": "1",
                      "strg": "0",
                      "intg": "0",
                      "dexg": "0",
                      "sklg": "0",
                      "spdg": "0",
                      "lukg": "0",
                      "cong": "0",
                      "wisg": "2"
                    },
                    "Fly": {
                      "Name": "Fly",
                      "Cost": "4",
                      "hp": "0",
                      "str": "0",
                      "int": "0",
                      "dex": "0",
                      "skl": "0",
                      "spd": "0",
                      "luk": "0",
                      "con": "0",
                      "wis": "0",
                      "mov": "0",
                      "hpg": "0",
                      "strg": "0",
                      "intg": "0",
                      "dexg": "0",
                      "sklg": "0",
                      "spdg": "0",
                      "lukg": "0",
                      "cong": "0",
                      "wisg": "0"
                    },
                    "Combat Skill": {
                      "Name": "Combat Skill",
                      "Cost": "3",
                      "hp": "0",
                      "str": "0",
                      "int": "0",
                      "dex": "0",
                      "skl": "0",
                      "spd": "0",
                      "luk": "0",
                      "con": "0",
                      "wis": "0",
                      "mov": "0",
                      "hpg": "0",
                      "strg": "0",
                      "intg": "0",
                      "dexg": "0",
                      "sklg": "0",
                      "spdg": "0",
                      "lukg": "0",
                      "cong": "0",
                      "wisg": "0"
                    }
                  };
                var StatChanges = {
                    "hp":0,
                    "str":0,
                    "int":0,
                    "dex":0,
                    "spd":0,
                    "luk":0,
                    "con":0,
                    "wis":0,
                    "mov":0
                };
                var GrowthChanges = {
                    "hp":0,
                    "str":0,
                    "int":0,
                    "dex":0,
                    "spd":0,
                    "luk":0,
                    "con":0,
                    "wis":0
                };
                getSectionIDs("repeating_ClassSkillsList", function(idarray) {
                    StatList.forEach(stat => {
                        idarray.forEach(rowid => {
                            let SkillName = `repeating_ClassSkillsList_${rowid}_ClassSkill`;
                            getAttrs([SkillName], function(values) {
                                let SkillNameValue = values[SkillName];
                                console.log(`${SkillNameValue} - ${stat} - ${stat}g`);
                                StatChanges[stat] = parseInt(StatChanges[stat]) + parseInt(ClassSkillsCost[SkillNameValue][stat]);
                                GrowthChanges[stat] = parseInt(GrowthChanges[stat]) + parseInt(ClassSkillsCost[SkillNameValue][`${stat}g`]);
                                setAttrs({
                                    [`${stat}_stat_skill`]: StatChanges[stat],
                                    [`${stat}_growth_skill`]: GrowthChanges[stat]
                                });
                            });
                        });
                    });
                    idarray.forEach(rowid => {
                        let SkillName = `repeating_ClassSkillsList_${rowid}_ClassSkill`;
                        getAttrs([SkillName], function(values) {
                            let SkillNameValue = values[SkillName];
                            console.log(`${SkillNameValue} - mov`);
                            StatChanges["mov"] = parseInt(StatChanges["mov"]) + parseInt(ClassSkillsCost[SkillNameValue]["mov"]);
                            setAttrs({
                                [`mov_stat_skill`]: StatChanges["mov"]
                            });
                        });
                    });
                });
            };

            on("change:repeating_ClassSkillsList:ClassSkill", function(eventInfo) {
                getAttrs(["repeating_ClassSkillsList_ClassSkill"], function(values) {
                    let SkillName = values.repeating_ClassSkillsList_ClassSkill;
                    setAttrs({
                        repeating_ClassSkillsList_ClassSkillCost: ClassSkills[SkillName]["Cost"],
                        repeating_ClassSkillsList_ClassSkillDescription: ClassSkills[SkillName]["Description"],
                        repeating_ClassSkillsList_ClassSkillEffect: ClassSkills[SkillName]["Effect"]
                    });
                });
                CalculateSkillStats();
            });
        
        </script>

    </div>
    <!-- ToDo: Finish Class skills Section-->

    <!-- Notes -->
    <div class="NotesItem">
        <h1 class="PrimaryTitle" data-i18n="Character-Description-title-u">Description</h1>
        <textarea name="attr_character_full_description" class="PrimaryNotesEntry" placeholder="Here is a place to keep a fuller description of your character" data-i18n-place="sheet-CharacterDescriptionPlaceholder" ></textarea>
    </div>
    <div class="NotesItem">
        <h1 class="PrimaryTitle" data-i18n="Character-Allies-title-u">Allies</h1>
        <textarea name="attr_character_allies" class="PrimaryNotesEntry" placeholder="Here is a place to keep a description of the people and organizations you have a relationship with" data-i18n-place="sheet-CharacterAlliesPlaceholder" ></textarea>
    </div>
    <div class="NotesItem">
        <h1 class="PrimaryTitle" data-i18n="Character-History-title-u">History</h1>
        <textarea name="attr_character_history" class="PrimaryNotesEntry" placeholder="Here is a place to keep a character history" data-i18n-place="sheet-CharacterHistoryPlaceholder" ></textarea>
    </div>
    <div class="NotesItem">
        <h1 class="PrimaryTitle" data-i18n="Character-Misc-Notes-title-u">Notes</h1>
        <textarea name="attr_character_misc" class="PrimaryNotesEntry" placeholder="Any additional notes you wish to keep can go here" data-i18n-place="sheet-CharacterMiscPlaceholder" ></textarea>
    </div>

    <!-- Configuration -->
    <div class="ConfigurationBigItem">
        <h1 class="PrimaryTitle" data-i18n="Character-Config-title-u">Sheet Config</h1>
        <label class="PrimaryLabel"><input type="checkbox" name="attr_StaticLevels" value="1" ><span data-i18n="Settings-StaticLevels-name-n"> Static Levels</span></label>
        <span data-i18n="Settings-StaticLevels-description">Instead of rolling your stats, you gain stat growths at a regular pace.</span>
        <label class="PrimaryLabel"><input type="checkbox" name="attr_NoBadLevels" value="1" ><span data-i18n="Settings-NoBadLevels-name-n"> No Bad Levels</span></label>
        <span data-i18n="Settings-NoBadLevels-Description">Guarentees 3 stat growths per level, but not what they are</span>
        <label class="PrimaryLabel"><input type="checkbox" name="attr_NoBadStats" value="1" ><span data-i18n="Settings-NoBadStats-name-n"> No Bad Stats</span></label>
        <span data-i18n="Settings-NoBadStats-Description">Not growing a stat increases it's chance of growing the next level.</span>
    </div>

</div>
